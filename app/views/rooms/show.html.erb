<% content_for(:title, @room.name) %>
<div class="room-intro-page-container">
  <div class="room-detail-wrapper">
    <%= image_tag @room.room_image, class: 'room-image' if @room.room_image.attached? %>
    <div class="overview">
      <div class="icon-name">
        <%= image_tag @room.user.image.attached? ? @room.user.image : "/assets/default_icon.jpg", class: 'owner-icon' %>
        <p><%= @room.name %></p>
      </div>
      <div class="adress-score">
        <p><%= @room.adress %></p>
        <% if @room.rates.size >= 2 %>
          <div class="room-score">
            <div class="star-container">
              <i class="fa-solid fa-star"></i>
            </div>
            <p><%= @avg_scores %><span class="num-score">(<%= @num_scores %>)</span></p>
            <div class="pencil-container">
              <i class="fa-solid fa-pencil"></i>
            </div>
            <p><%= @deviation %></p>
            <% if @room.award_count_or_false_if_zero %>
              <div class="gem-container">
                <i class="fa-solid fa-gem"></i>
              </div>
              <p><%= @room.award_count_or_false_if_zero %></p>
            <% end %>
          </div>
        <% else %>
          <p class="none-rate-message">評価は3件以上から公開されます</p>
        <% end %>
      </div>
    </div>
    <div class="room-intro-container">
      <div class="intro-box">
        <p><%= safe_join(@room.introduction.split("\n"), tag(:br)) %></p>
      </div>
    </div>
  </div>
  <div class="reservation-entry-form-container">
    <p>¥<%= @room.fee %>/日</p>
    <div class="error-message-field">
      <%= render "shared/flash_error" %>
    </div>
    <%= form_with url:"../reservations/new",  class: "reservation-entry-form", method: :get do |f| %>
      <%= f.label :checkin, "チェックイン" %>
      <%= f.date_field :checkin, class:"reservation-entry-form-date-field", value: params[:checkin] || "" %>
      <%= f.label :checkout, "チェックアウト" %>
      <%= f.date_field :checkout, class:"reservation-entry-form-date-field", value: params[:checkout] || ""  %>
      <%= f.label :number, "宿泊人数" %>
      <%= f.number_field :number, class:"reservation-entry-form-number-field", placeholder: "人", value: params[:number] || ""  %>
      <%= f.hidden_field :room_id, value: @room.id %>
      <% if !user_signed_in? %>
        <%= f.submit 'ログイン', name: nil, class:"reservation-entry-form-submit" %>
      <% elsif current_user.invalid? %>
        <%= f.submit 'プロフィール登録', name: nil, class:"reservation-entry-form-submit"  %>
      <% else %>
        <%= f.submit "予約する", name: nil, class:"reservation-entry-form-submit" %>
      <% end %>
    <% end %>
  </div>
</div>
