<% content_for(:script) do %>
  document.addEventListener('turbolinks:load', function() {
    $('.avg-scores').raty({
      size      : 36,
      starOff   : '<%= asset_path('star-off.png') %>',
      starOn    : '<%= asset_path('star-on.png') %>',
      starHalf  : '<%= asset_path('star-half.png') %>',
      half      : true,
      readOnly  : true,
      score     : <%= @avg_scores %>,
    });
  });

  document.addEventListener('turbolinks:load', function() {
    $('.avg-cleanliness').raty({
      size      : 32,
      starOff   : '<%= asset_path('star-off.png') %>',
      starOn    : '<%= asset_path('star-on.png') %>',
      starHalf  : '<%= asset_path('star-half.png') %>',
      half      : true,
      readOnly  : true,
      score     : <%= @avg_cleanliness %>,
    });
  });

  document.addEventListener('turbolinks:load', function() {
    $('.avg-information').raty({
      size      : 32,
      starOff   : '<%= asset_path('star-off.png') %>',
      starOn    : '<%= asset_path('star-on.png') %>',
      starHalf  : '<%= asset_path('star-half.png') %>',
      half      : true,
      readOnly  : true,
      score     : <%= @avg_information %>,
    });
  });

  document.addEventListener('turbolinks:load', function() {
    $('.avg-communication').raty({
      size      : 32,
      starOff   : '<%= asset_path('star-off.png') %>',
      starOn    : '<%= asset_path('star-on.png') %>',
      starHalf  : '<%= asset_path('star-half.png') %>',
      half      : true,
      readOnly  : true,
      score     : <%= @avg_communication %>,
    });
  });

  document.addEventListener('turbolinks:load', function() {
    $('.avg-location').raty({
      size      : 32,
      starOff   : '<%= asset_path('star-off.png') %>',
      starOn    : '<%= asset_path('star-on.png') %>',
      starHalf  : '<%= asset_path('star-half.png') %>',
      half      : true,
      readOnly  : true,
      score     : <%= @avg_location %>,
    });
  });

  document.addEventListener('turbolinks:load', function() {
    $('.avg-price').raty({
      size      : 32,
      starOff   : '<%= asset_path('star-off.png') %>',
      starOn    : '<%= asset_path('star-on.png') %>',
      starHalf  : '<%= asset_path('star-half.png') %>',
      half      : true,
      readOnly  : true,
      score     : <%= @avg_price %>,
    });
  });

  document.addEventListener('turbolinks:load', function() {
    $('.avg-recommendation').raty({
      size      : 32,
      starOff   : '<%= asset_path('star-off.png') %>',
      starOn    : '<%= asset_path('star-on.png') %>',
      starHalf  : '<%= asset_path('star-half.png') %>',
      half      : true,
      readOnly  : true,
      score     : <%= @avg_recommendation %>,
    });
  });
<% end %>

<% content_for(:title, @room.name) %>
<div class="room-intro-page-container">
  <div class="room-detail-wrapper">
    <%= image_tag @room.room_image, class: 'room-image' if @room.room_image.attached? %>
    <div class="overview">
      <div class="icon-name">
        <%= image_tag @room.user.image.attached? ? @room.user.image : "/assets/default_icon.jpg", class: 'owner-icon' %>
        <p><%= @room.name %></p>
      </div>
      <div class="adress-score">
        <p><%= @room.adress %></p>
        <% if @room.has_min_num_rates? %>
          <div class="room-score">
            <div class="pencil-container">
              <i class="fa-solid fa-pencil"></i>
            </div>
            <p>
              <span class="deviation"><%= @deviation %></span>
              <% if !@num_awards.zero? %>
                <span>
                <span class="gem-container">
                  <i class="fa-solid fa-gem"></i>
                </span>
                <%= @num_awards %>
                </span>
              <% end %>
              <a id="modal-open" class="button-link">
                (<%= @num_scores %>件)
              </a>
            </p>
          </div>
        <% else %>
          <p class="none-rate-message">評価は2件以上から公開されます</p>
        <% end %>
      </div>
    </div>
    <div class="room-intro-container">
      <div class="intro-box">
        <p><%= safe_join(@room.introduction.split("\n"), tag(:br)) %></p>
      </div>
    </div>
  </div>
  <div class="reservation-entry-form-container">
    <p>¥<%= @room.fee %>/日</p>
    <div class="error-message-field">
      <%= render "shared/flash_error" %>
    </div>
    <%= form_with url:"../reservations/new",  class: "reservation-entry-form", method: :get do |f| %>
      <%= f.label :checkin, "チェックイン" %>
      <%= f.date_field :checkin, class:"reservation-entry-form-date-field", value: params[:checkin] || "" %>
      <%= f.label :checkout, "チェックアウト" %>
      <%= f.date_field :checkout, class:"reservation-entry-form-date-field", value: params[:checkout] || ""  %>
      <%= f.label :number, "宿泊人数" %>
      <%= f.number_field :number, class:"reservation-entry-form-number-field", placeholder: "人", value: params[:number] || ""  %>
      <%= f.hidden_field :room_id, value: @room.id %>
      <% if !user_signed_in? %>
        <%= f.submit 'ログイン', name: nil, class:"reservation-entry-form-submit" %>
      <% elsif current_user.invalid? %>
        <%= f.submit 'プロフィール登録', name: nil, class:"reservation-entry-form-submit"  %>
      <% else %>
        <%= f.submit "予約する", name: nil, class:"reservation-entry-form-submit" %>
      <% end %>
    <% end %>
  </div>
</div>
