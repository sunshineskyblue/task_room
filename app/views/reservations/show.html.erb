<% content_for(:title, "予約内容") %>
<div class="guest-container">
  <% if @reservation.canceled? %>
    <p class="note-cancel-done">
      この予約はキャンセルされました。</br>
      キャンセルポリシーに従い自動的に返金処理がされます。
    </p>
  <% elsif @reservation.cancel_requested? %>
    <p class="note-cancel-done">
      ホストからキャンセルリクエストがありました。</br>
      キャンセルポリシーに従って返金がされます。</br>
      </br>
      キャンセルポリシーをご確認頂きましたら、</br>
      「この予約をキャンセルする」をクリックしてください</br>
    </p>
  <% end %>

  <div class="rate-field-container">
    <p>評価をお願いします
      <span class="must">（必須）</span>
    </p>
    <%= form_with model: @rate, url: rates_path, method: 'post' do |f| %>
      <div class="error-message-field">
        <%= render "shared/flash_error" %>
      </div>
      <div class="rate-field">
        <%= render "shared/rate" %>
        <div class="award">
          <p>ベスト評価を与える</p>
          <p class="explain">１年に１回のみ送ることができる、星６の感動を伝える特別な評価となります</p>
          <i class="fa-solid fa-gem gray-diamond"></i>
        </div>
        <%= f.submit "送信", name: nil, class: "rate-submit" %>
      </div>
      <%= f.hidden_field :room_id, value: @reservation.room.id %>
      <%= f.hidden_field :room_id, value: @reservation.room.id %>
      <%= f.hidden_field :price_category, value: @reservation.room.price.range %>
      <%= f.hidden_field :cleanliness, id: "cleanliness-value" %>
      <%= f.hidden_field :information, id: "information-value" %>
      <%= f.hidden_field :communication, id: "communication-value" %>
      <%= f.hidden_field :location, id: "location-value" %>
      <%= f.hidden_field :price, id: "price-value" %>
      <%= f.hidden_field :recommendation, id: "recommendation-value" %>
      <%= f.hidden_field :award, value: 0, id: "award-value" %>
    <% end %>
  </div>

  <h1>予約内容</h1>
  <div class="error-message-field">
    <%= render "shared/error", resource: @reservation %>
  </div>
  <%= render "shared/reservation_content", reservation: @reservation %>
  <h1>ホスト情報</h1>
  <div class="user-box-container">
    <div class="user-box">
      <%= image_tag @reservation.host.image, class: 'user-image' if @reservation.host.image.attached? %>
      <div class="user-headline">
        <div class="user-name">
          <%= @reservation.host.name %>
        </div>
        <div class="user-status">
          <span>本人認証済</span>
        </div>
      </div>
    </div>
    <div class="user-introduction">
      <%= safe_join(@reservation.host.introduction.split(/\n/), tag(:br)) %>
    </div>
  </div>
  <div class="guest-cancel-container">
    <% if @reservation.ongoing? %>
      <p>予約内容は修正はできません。この予約をキャンセルしてから再度お申込みください</p>
      <%= link_to "この予約をキャンセルする", reservation_path(@reservation.id), method: 'patch', data: {confirm: "必ずキャンセルポリシーをご確認後、キャンセルをしてください"}, class:"reservation-cancel-button" %>
      <%= link_to "一覧に戻る >>", reservations_path, class:"link-to-reservations" %>
    <% else %>
      <%= link_to "一覧に戻る >>", completed_reservations_path, class:"link-to-reservations" %>
    <% end %>
  </div>
</div>
